<!DOCTYPE html>
<html lang="en">
	<head>
		<!--Ensures that the browser interprets the characters in the
			document correctly and displays them as intended.-->
		<meta charset="UTF-8">
		<!-- ensures that the content is scaled properly to fit the
			screen size and is at its original size without any zooming. -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title> MQTT Web Application</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
		<!-- Include the script file -->
	</head>
	<body style="background-color:powderblue;">

		<h1><b>Wear Cast</b></h1>
		<hr>
		<h4>don't know what to wear? <br> don't worry, we got you!</h4>

		<img alt="Great outfit inspo" src="/src/web/assets/img/outfit.jpeg" width="600" height="1100">
        <img alt="Amazing outfit inspo" src="/src/web/assets/img/outfit2.jpeg" width="600" height="1100">

    	<p id="temperatureParagraph"> Temperature: </p>
		<p id="humidityParagraph"> Humidity: </p>

		<script>
			// Create an MQTT client instance
			var client = new Paho.MQTT.Client("broker.emqx.io", 8083, "clientId");

			// Set callback handlers
			client.onConnectionLost = onConnectionLost;
			client.onMessageArrived = onMessageArrived;

			// Connect to MQTT broker
			client.connect({
				onSuccess: onConnect,
				// Other connection options if needed
			});

			// Called when the client connects
			function onConnect() {
				console.log("Connected to MQTT broker");
				// Subscribe to a topic
				client.subscribe("Temperature");
				client.subscribe("Humidity");
			}

			// Called when the client loses its connection
			function onConnectionLost(responseObject) {
				if (responseObject.errorCode !== 0) {
					console.log("Connection lost: " + responseObject.errorMessage);
				}
			}

			// Called when a message arrives
			function onMessageArrived(message) {
				console.log("Message received: " + message.payloadString);
				
				// Handle the incoming messages
				// Extract temperature and humidity value based on topic
				var topic = message.destinationName;
				var sensorValue = message.payloadString;
				if (topic === "Temperature") {
					document.getElementById("temperatureParagraph").textContent = "Temperature: " + sensorValue;
				} else if (topic === "Humidity") {
					document.getElementById("humidityParagraph").textContent = "Humidity: " + sensorValue;
				}
			}

		</script>
		<br>
	</body>
</html>